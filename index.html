<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Control</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body onload="initApp()">

    <div id="auth-container">
        <h2>Bem-vindo!</h2>
        <p>Fa√ßa login ou crie uma conta para come√ßar a gerenciar suas finan√ßas.</p>

        <div class="auth-form">
            <input type="email" id="auth-email" placeholder="Email">
            <input type="password" id="auth-password" placeholder="Senha">
            <div class="auth-buttons">
                <button id="login-btn">Entrar</button>
                <button id="signup-btn">Criar Conta</button>
            </div>
            <p id="auth-error" class="error-message"></p>
        </div>
    </div>

    <div class="app-container" style="display: none;">

        <div class="sidebar">
            <div class="user-profile">
                <h3>Jo√£o Victor Amaro</h3>
                <small id="horaAtual"></small>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li id="menu-dashboard" onclick="mostrarConteudo('dashboard')">
                        <span>üìä Dashboard</span>
                    </li>
                    <li id="menu-relatorios" onclick="mostrarConteudo('relatorios')">
                        <span>üìà Relat√≥rios</span>
                    </li>
                    <li id="menu-despesas" onclick="mostrarConteudo('despesas')">
                        <span>üí∏ Despesas</span>
                    </li>
                    <li id="menu-investimentos" onclick="mostrarConteudo('investimentos')">
                        <span>üí∞ Investimentos</span>
                    </li>
                    <li id="menu-metas" onclick="mostrarConteudo('metas')">
                        <span>üéØ Metas</span>
                    </li>
                    <li id="menu-cartoes" onclick="mostrarConteudo('cartoes')">
                        <span>üí≥ Cart√µes</span>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="main-content-wrapper">

            <div id="content-dashboard" class="main-content active">
                <header>
                    <span>Seu dinheiro seguro!</span>
                    <div class="header-info">
                        M√™s: <span id="mesAtual"></span>
                        <button class="logout-btn">Sair</button>
                    </div>
                </header>

                <div class="summary-cards-container">
                    <div class="summary-card">
                        <h3>Receita Mensal</h3>
                        <div class="summary-value valor-receita" id="totalReceitas">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h3>Despesa Mensal</h3>
                        <div class="summary-value valor-despesa" id="totalDespesas">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h3>Saldo</h3>
                        <div class="summary-value valor-saldo" id="saldoMes">R$ 0,00</div>
                    </div>
                    <div class="summary-card">
                        <h3>Receita vs. Despesas</h3>
                        <div class="chart-container">
                            <canvas id="receitasDespesasChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Adicionar Movimenta√ß√£o</h3>
                    <div class="input-row" style="margin-bottom: 25px; display: flex; align-items: center; gap: 15px;">
                        <label for="mes">M√™s:</label>
                        <select id="mes" onchange="carregarDados()" style="padding: 8px; border-radius: 5px;">
                            <option value="1">Janeiro</option>
                            <option value="2">Fevereiro</option>
                            <option value="3">Mar√ßo</option>
                            <option value="4">Abril</option>
                            <option value="5">Maio</option>
                            <option value="6">Junho</option>
                            <option value="7">Julho</option>
                            <option value="8">Agosto</option>
                            <option value="9">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                        <label for="ano">Ano:</label>
                        <input type="number" id="ano" min="2000" max="2100" onchange="carregarDados()" style="padding: 8px; border-radius: 5px; max-width: 100px;">
                        <button class="form-add-btn" onclick="limparDados()" style="background: #e74c3c; box-shadow: none;">Limpar M√™s</button>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="transacaoDesc">Descri√ß√£o</label>
                            <input type="text" id="transacaoDesc" placeholder="Ex: Compra de teclado">
                        </div>
                        <div class="form-field">
                            <label for="transacaoValor">Valor</label>
                            <input type="number" id="transacaoValor" placeholder="Ex: 800.00">
                        </div>
                        <div class="form-field">
                            <label for="transacaoTipo">Tipo</label>
                            <select id="transacaoTipo" onchange="alternarCampos()">
                                <option value="receita">Receita</option>
                                <option value="despesa">Despesa</option>
                            </select>
                        </div>
                        <div class="form-field" id="campoTipoPagamento">
                            <label for="tipoPagamento">Meio</label>
                            <select id="tipoPagamento">
                                <option value="credito">Cr√©dito</option>
                                <option value="debito_pix">D√©bito/Pix</option>
                                <option value="dinheiro">Dinheiro</option>
                            </select>
                        </div>
                        <div class="form-field" id="campoCategoria">
                            <label for="transacaoCategoria">Categoria</label>
                            <select id="transacaoCategoria">
                                <option value="salario">Sal√°rio</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <button class="form-add-btn" onclick="adicionarTransacao()">Adicionar</button>
                    </div>
                </div>

                <div class="movimentacoes-section">
                    <h3>√öltimas Movimenta√ß√µes</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Categoria</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="listaMovimentacoes">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="content-relatorios" class="main-content">
                <h2>Relat√≥rios de Despesas por Categoria</h2>
                <div class="relatorios-section">
                    <p>Veja a distribui√ß√£o de seus gastos por categoria para o m√™s atual.</p>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="despesasPorCategoriaChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div id="content-despesas" class="main-content">
                <h2>Gerenciar Despesas</h2>
                <div class="despesas-section">
                    <p>Aqui est√£o todas as suas despesas para o m√™s atual, de forma detalhada.</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Data</th>
                                <th>Categoria</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="listaDespesas">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="content-investimentos" class="main-content">
                <h2>Gerenciar Investimentos</h2>
                <div class="investimentos-section">
                    <h3>Adicionar Novo Investimento</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="investimentoDesc">Descri√ß√£o</label>
                            <input type="text" id="investimentoDesc" placeholder="Ex: A√ß√£o da Empresa X">
                        </div>
                        <div class="form-field">
                            <label for="investimentoValor">Valor</label>
                            <input type="number" id="investimentoValor" placeholder="Ex: 1000.00">
                        </div>
                        <button class="form-add-btn" onclick="adicionarInvestimento()">Adicionar</button>
                    </div>
                </div>
                <div class="investimentos-section">
                    <h3>Meus Investimentos</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Data</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="listaInvestimentos">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="content-metas" class="main-content">
                <h2>Definir Metas Financeiras</h2>
                <div class="metas-section">
                    <h3>Adicionar Nova Meta</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label for="metaDesc">Descri√ß√£o</label>
                            <input type="text" id="metaDesc" placeholder="Ex: Viagem para o Jap√£o">
                        </div>
                        <div class="form-field">
                            <label for="metaAlvo">Valor Alvo</label>
                            <input type="number" id="metaAlvo" placeholder="Ex: 5000.00">
                        </div>
                        <div class="form-field">
                            <label for="metaAtual">Valor Atual</label>
                            <input type="number" id="metaAtual" placeholder="Ex: 500.00">
                        </div>
                        <button class="form-add-btn" onclick="adicionarMeta()">Adicionar</button>
                    </div>
                </div>
                <div class="metas-section">
                    <h3>Minhas Metas</h3>
                    <div id="listaMetas">
                    </div>
                </div>
            </div>

            <div id="content-cartoes" class="main-content">
                <h2>Cart√µes de Cr√©dito</h2>
                <p>Acompanhe as faturas e limites de seus cart√µes.</p>
                <div class="card-section">
                    <p>Esta se√ß√£o ainda est√° em constru√ß√£o. Aqui voc√™ poder√° adicionar e gerenciar seus cart√µes de cr√©dito.</p>
                    <p>Recursos futuros: Vis√£o geral de faturas, limites, datas de vencimento e hist√≥ricos de transa√ß√µes.</p>
                </div>
            </div>
            
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        // Importa os m√≥dulos necess√°rios
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

        // Sua configura√ß√£o do projeto Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDPkYOG9BdBkGCVIZOIQigKMN-yQP_p1S8",
            authDomain: "controle-financeiro-55062.firebaseapp.com",
            projectId: "controle-financeiro-55062",
            storageBucket: "controle-financeiro-55062.firebasestorage.app",
            messagingSenderId: "96852370466",
            appId: "1:96852370466:web:ef255f1224b70b2428967b"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app); // Inicializa o m√≥dulo de autentica√ß√£o
        const database = getDatabase(app); // Inicializa o m√≥dulo do banco de dados

        // Exponha o auth e o database globalmente para que main.js possa us√°-los
        window.firebase = { auth, database };
        window.onAuthStateChanged = onAuthStateChanged;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.ref = ref;
        window.set = set;
        window.onValue = onValue;
        window.remove = remove;
        window.getDatabase = getDatabase;

        // Adiciona a l√≥gica de autentica√ß√£o
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.querySelector('.app-container');
        const logoutBtn = document.querySelector('.logout-btn');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usu√°rio est√° logado
                authContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                console.log("Usu√°rio logado:", user);
            } else {
                // Usu√°rio n√£o est√° logado
                authContainer.style.display = 'flex';
                appContainer.style.display = 'none';
                console.log("Nenhum usu√°rio logado.");
            }
        });

        document.getElementById('signup-btn').addEventListener('click', () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const errorElement = document.getElementById('auth-error');

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    console.log("Usu√°rio criado com sucesso!", userCredential.user);
                    errorElement.textContent = "Conta criada com sucesso!";
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    console.error("Erro ao criar conta:", errorMessage);
                    errorElement.textContent = `Erro: ${errorMessage}`;
                });
        });

        document.getElementById('login-btn').addEventListener('click', () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const errorElement = document.getElementById('auth-error');

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    console.log("Login realizado com sucesso!", userCredential.user);
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    console.error("Erro ao fazer login:", errorMessage);
                    errorElement.textContent = `Erro: ${errorMessage}`;
                });
        });

        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                signOut(auth).then(() => {
                    console.log("Usu√°rio deslogado com sucesso.");
                }).catch((error) => {
                    console.error("Erro ao fazer logout:", error);
                });
            });
        }
    </script>
    
    <script src="main.js"></script>
</body>
</html>
